@inject PlayerManager playerManager
@code {
    [Parameter] public bool IsOpen { get; set; }
    [Parameter] public EventCallback OnClose { get; set; }
    [Parameter] public EventCallback<string> OnSubmit { get; set; }

    private string Name { get; set; } = string.Empty;
    private bool ShowValidation { get; set; } = false;
    private bool ShowValidationNameExist { get; set; } = false;
    private bool RuleCheckbox { get; set; } = false;
    private bool RuleCheckboxValidation { get; set; } = false;

    private async Task SubmitAsync()
    {
        if (string.IsNullOrWhiteSpace(Name))
        {
            ShowValidation = true;
            return;
        }
        else
        {
            ShowValidation = false;
        }

        if (playerManager.CheckIfPlayerNameExists(Name))
        {
            ShowValidationNameExist = true;
            return;
        }
        else
        {
            ShowValidationNameExist = false;
        }

        if (!RuleCheckbox)
        {
            RuleCheckboxValidation = true;
            return;
        }
        else
        {
            RuleCheckboxValidation = false;
        }

        ShowValidation = false;
        ShowValidationNameExist = false;
        RuleCheckboxValidation = false;
        await OnSubmit.InvokeAsync(Name);
        await OnClose.InvokeAsync();
        Name = string.Empty;
    }

    private async Task CancelAsync()
    {
        Name = string.Empty;
        ShowValidation = false;
        ShowValidationNameExist = false;
        await OnClose.InvokeAsync();
    }
}

@if (IsOpen)
{
    <!-- Modal Overlay -->
    <div class="inset-0 z-[1000] flex items-center justify-center"
         style="position:fixed; top: 0; left: 30%; right: 30%; bottom: 0;">

        <!-- Modal Box -->
        <div class="z-[1001] w-full max-w-md rounded-lg border p-6 shadow-xl"
             style="background-color: #1f2937;">

            <!-- Heading -->
            <h2 class="mb-4 text-xl font-semibold text-white">
                Enter Your Name
            </h2>

            <!-- Input -->
            <input @bind="Name"
                   type="text"
                   placeholder="Your Name"
                   class="placeholder-gray-400 w-full rounded border border-gray-500 bg-gray-700 px-4 py-2 text-white focus:ring-2 focus:ring-blue-500 focus:outline-none" />

            @if (ShowValidation)
            {
                <p class="mt-1 text-sm font-normal text-red-500">
                    Please enter a valid name.
                </p>
            }
            @if (ShowValidationNameExist)
            {
                <p class="mt-1 text-sm font-normal text-red-500">
                    This name already exists. Please choose another.
                </p>
			}

            <div class="mt-2">
                <h2 class="mb-2 text-lg font-semibold text-white">🎮 How to Play</h2>
                <ul class="list-inside list-disc space-y-1 text-sm text-gray-300">
                    <li>The objective is to <strong>find and eliminate the bot</strong> among the players.</li>
                    <li>Use the <strong>chat</strong> to talk with other players and gather clues.</li>
                    <li>If you suspect someone is a bot, <strong>give them a higher star rating</strong>.</li>
                    <li>At the end of the round timer, the player with the <strong>highest star rating</strong> will be eliminated.</li>
                    <li>The game continues until all bots are eliminated or only bots remain.</li>
                    <li>Do not share personal information — keep it game-related.</li>
                    <li>Be strategic! Bots can act human, and humans can try to trick you.</li>
                </ul>

                <!-- Checkbox -->
                <div class="mt-3 flex items-center space-x-2">
                    <InputCheckbox @bind-Value="RuleCheckbox" class="form-checkbox h-4 w-4 text-blue-600" />
                    <label class="text-sm text-gray-300">I understand and agree to the game rules</label>
                </div>

                @if (RuleCheckboxValidation)
                {
                    <p class="mt-1 text-sm font-normal text-red-500">
                        You must confirm that you understand the rules before continuing.
                    </p>
                }
            </div>


            <!-- Action Buttons -->
            <div class="mt-4 flex justify-end gap-2">
                <button @onclick="CancelAsync"
                        class="cursor-pointer rounded bg-gray-500 px-4 py-2 text-white hover:bg-gray-600">
                    Cancel
                </button>
                <button @onclick="SubmitAsync"
                        class="cursor-pointer rounded bg-blue-600 px-4 py-2 text-white hover:bg-blue-700">
                    Submit
                </button>
            </div>
        </div>
    </div>
}
